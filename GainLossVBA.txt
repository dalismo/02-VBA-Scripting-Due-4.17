Sub GainLoss()

'goes across each worksheet
For Each ws In Worksheets

'setting variables for column info
        Dim StkOpen As Double
        Dim StkClose As Double
        Dim Vol As Double
        Dim Tick As String
        Dim YrChange As Double
        Dim PerChange As Double
        Dim lastrow As Double
        lastrow = ws.Cells(Rows.Count, 1).End(xlUp).Row

'inserting Column names
        ws.Range("I1") = "Ticker"
        ws.Range("J1") = "Yearly Change"
        ws.Range("K1") = "Percent Change"
        ws.Range("L1") = "Total Stock Volume"

'start at 0
        Vol = 0
        Dim Stats As Double
        Stats = 2

'start of loop across rows
For i = 2 To lastrow

'not equal comparison
        If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1) Then
        Tick = ws.Cells(i, 1).Value

'adds up total volume for same ticker across rows
        Vol = Vol + ws.Cells(i, 7).Value

'inserting values
        ws.Range("I" & Stats).Value = Tick
        ws.Range("L" & Stats).Value = Vol

'start at 0
        Vol = 0

'stock open and close info and calc
        StkClose = ws.Cells(i, 6)
        
        If StkOpen = 0 Then
            YrChange = 0
            PerChange = 0
        
        Else:
            YrChange = StkClose - StkOpen
            PerChange = (StkClose - StkOpen) / StkOpen
        
        End If

'assigning values, styling and formating
        ws.Range("J" & Stats).Value = YrChange
        ws.Range("K" & Stats).Value = PerChange
        ws.Range("K" & Stats).Style = "Percent"
        ws.Range("K" & Stats).NumberFormat = "0.00%"
        Stats = Stats + 1

'not equal comparison
        ElseIf ws.Cells(i - 1, 1).Value <> ws.Cells(i, 1) Then
        StkOpen = ws.Cells(i, 3)

'pulling volume from column 7 cells
        Else: Vol = Vol + ws.Cells(i, 7).Value
      
        End If
    
'loop to next row
Next i

'adding colors to cells for Column J down to lastrow
    For r = 2 To lastrow
        
        If ws.Range("J" & r).Value > 0 Then
        ws.Range("J" & r).Interior.ColorIndex = 4
        
        ElseIf ws.Range("J" & r).Value < 0 Then
        ws.Range("J" & r).Interior.ColorIndex = 3
        
        End If
        
Next r
      
'autofitting columns with data across worksheets
        ws.Columns.AutoFit
  
Next ws

End Sub





